(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"afd1a2c8-1d92-4db4-bc3d-eb53898c648a","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),te=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(u),W=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(u),oe=e=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(u),ne=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e.avatar})}).then(u),re=e=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(u),ce=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(u),se=(e,t)=>{const o=t?"DELETE":"PUT";return fetch(`${s.baseUrl}/cards/likes/${e}`,{method:o,headers:s.headers}).then(u)},ie=(e,t)=>e.some(o=>o._id===t),le=(e,t)=>{const o=e.querySelector(".card__like-count");o&&(o.textContent=t)},ae=e=>{e.classList.toggle("card__like-button_is-active")},ue=e=>{e.remove()},pe=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),H=(e,t,o)=>{const n=pe(),r=n.querySelector(".card__like-button"),c=n.querySelector(".card__control-button_type_delete"),p=n.querySelector(".card__control-button_type_info"),S=n.querySelector(".card__image"),M=n.querySelector(".card__like-count");return S.src=e.link,S.alt=e.name,n.querySelector(".card__title").textContent=e.name,M&&(M.textContent=e.likes.length),ie(e.likes,t)&&r.classList.add("card__like-button_is-active"),e.owner._id!==t?c.remove():o.onDeleteCard&&c.addEventListener("click",()=>{o.onDeleteCard(n,e._id)}),o.onLikeIcon&&r.addEventListener("click",()=>{const ee=r.classList.contains("card__like-button_is-active");o.onLikeIcon(n,e._id,ee)}),o.onPreviewPicture&&S.addEventListener("click",()=>{o.onPreviewPicture({name:e.name,link:e.link})}),p&&o.onInfoClick&&p.addEventListener("click",()=>{o.onInfoClick(e._id)}),n},j=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}},d=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",j)},l=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",j)},de=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{l(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&l(e)})};function me(e,t,o){const n=e.querySelector(`#${t.id}-error`);let r=t.validationMessage;t.validity.patternMismatch&&t.dataset.errorMessage&&(r=t.dataset.errorMessage),n.textContent=r,n.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}function D(e,t,o){const n=e.querySelector(`#${t.id}-error`);n.textContent="",n.classList.remove(o.errorClass),t.classList.remove(o.inputErrorClass)}function _e(e,t,o){t.validity.valid?D(e,t,o):me(e,t,o)}function fe(e){return e.some(t=>!t.validity.valid)}function J(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function R(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}function T(e,t,o){fe(e)?J(t,o):R(t,o)}function ye(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);T(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{_e(e,r,t),T(o,n,t)})})}function b(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{D(e,r,t)}),J(n,t)}function he(e){document.querySelectorAll(e.formSelector).forEach(o=>ye(o,e))}const _={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};he(_);let C=null,L=null,q=null;const V=document.querySelector(".places__list"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),ve=document.querySelector(".profile__edit-button"),Se=document.querySelector(".profile__add-button"),B=document.querySelector(".popup_type_edit"),y=B.querySelector(".popup__form"),z=y.querySelector(".popup__input_type_name"),K=y.querySelector(".popup__input_type_description"),g=y.querySelector(".popup__button"),P=document.querySelector(".popup_type_new-card"),a=P.querySelector(".popup__form"),Ce=a.querySelector(".popup__input_type_card-name"),Le=a.querySelector(".popup__input_type_url"),U=a.querySelector(".popup__button"),w=document.querySelector(".popup_type_image"),$=w.querySelector(".popup__image"),qe=w.querySelector(".popup__caption"),x=document.querySelector(".popup_type_edit-avatar"),f=x.querySelector(".popup__form"),ge=f.querySelector(".popup__input"),A=f.querySelector(".popup__button"),F=document.querySelector(".popup_type_remove-card"),G=F.querySelector(".popup__form"),O=G.querySelector(".popup__button"),h=document.querySelector(".popup_type_info"),be=h.querySelector(".popup__title"),m=h.querySelector(".popup__info"),ke=h.querySelector(".popup__text"),N=h.querySelector(".popup__list"),i=(e,t,o,n)=>{t?(e.textContent=o,e.disabled=!0):(e.textContent=n,e.disabled=!1)},Ee=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),v=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Ie=e=>{const t=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0),o=e.length>12?e.slice(0,12)+"...":e;return t.textContent=o,t.title=e,t},Q=({name:e,link:t})=>{$.src=t,$.alt=e,qe.textContent=e,d(w)},X=(e,t,o)=>{se(t,o).then(n=>{const r=e.querySelector(".card__like-button");ae(r),le(e,n.likes.length)}).catch(n=>{console.log(n)})},Y=(e,t)=>{L=e,q=t,d(F)},Be=e=>{e.preventDefault(),i(O,!0,"Удаление...","Да"),ce(q).then(()=>{ue(L),l(F),L=null,q=null}).catch(t=>{console.log(t)}).finally(()=>{i(O,!1,"Удаление...","Да")})},Z=e=>{W().then(t=>{const o=t.find(n=>n._id===e);if(!o){console.log("Карточка не найдена");return}m.innerHTML="",N.innerHTML="",be.textContent="Информация о карточке",m.append(v("Описание:",o.name)),m.append(v("Дата создания:",Ee(new Date(o.createdAt)))),m.append(v("Владелец:",o.owner.name)),m.append(v("Количество лайков:",o.likes.length.toString())),ke.textContent=o.likes.length>0?"Лайкнули:":"",o.likes.forEach(n=>{N.append(Ie(n.name))}),d(h)}).catch(t=>{console.log(t)})},Pe=e=>{e.preventDefault(),i(g,!0,"Сохранение...","Сохранить"),oe({name:z.value,about:K.value}).then(t=>{k.textContent=t.name,E.textContent=t.about,l(B)}).catch(t=>{console.log(t)}).finally(()=>{i(g,!1,"Сохранение...","Сохранить")})},we=e=>{e.preventDefault(),i(A,!0,"Сохранение...","Сохранить"),ne({avatar:ge.value}).then(t=>{I.style.backgroundImage=`url(${t.avatar})`,l(x)}).catch(t=>{console.log(t)}).finally(()=>{i(A,!1,"Сохранение...","Сохранить")})},xe=e=>{e.preventDefault(),i(U,!0,"Создание...","Создать"),re({name:Ce.value,link:Le.value}).then(t=>{V.prepend(H(t,C,{onPreviewPicture:Q,onLikeIcon:X,onDeleteCard:Y,onInfoClick:Z})),a.reset(),l(P)}).catch(t=>{console.log(t)}).finally(()=>{i(U,!1,"Создание...","Создать")})};ve.addEventListener("click",()=>{z.value=k.textContent,K.value=E.textContent,b(y,_),R(g,_),d(B)});I.addEventListener("click",()=>{f.reset(),b(f,_),d(x)});Se.addEventListener("click",()=>{a.reset(),b(a,_),d(P)});y.addEventListener("submit",Pe);f.addEventListener("submit",we);a.addEventListener("submit",xe);G.addEventListener("submit",Be);const Fe=document.querySelectorAll(".popup");Fe.forEach(e=>{de(e)});Promise.all([te(),W()]).then(([e,t])=>{C=e._id,k.textContent=e.name,E.textContent=e.about,I.style.backgroundImage=`url(${e.avatar})`,t.forEach(o=>{V.append(H(o,C,{onPreviewPicture:Q,onLikeIcon:X,onDeleteCard:Y,onInfoClick:Z}))})}).catch(e=>{console.log(e)});
